//设置缓存
function set_cache(key,value){
	if(key==''){ return false;}
	localStorage.setItem(key, value);
}

//读取缓存
function get_cache(key){
	return localStorage.getItem(key);
}

//删除缓存
function remove_cache(key){
	localStorage.removeItem(key);
}

//获取24条缓存
function getAllCache_24(){
	var arr=[];
	for (var i = 0; i < localStorage.length; i++) {
	    var key = localStorage.key(i);
		if(key.indexOf("indexdata") == -1 && key.indexOf("rank_data") == -1){
			var obh = {'time':key,'vname':localStorage.getItem(key)};
			arr.push(obh);
		}
	}
	var res = insertSort(arr).slice(0,48);
	if(res.length == 0){
		res.push({"time":"","vname":"暂无记录！"});
	}
	return res;
}

//获取全部缓存
function getAllCache(){
	var arr=[];
	for (var i = 0; i < localStorage.length; i++) {
	    var key = localStorage.key(i); 
		if(key.indexOf("indexdata") == -1 && key.indexOf("rank_data") == -1){
			var obh = {'time':key,'vname':localStorage.getItem(key)};
			arr.push(obh);
		}
	}
	if(arr.length == 0){
		arr.push({"time":"","vname":"暂无记录"});
	}
	return arr;
}

//清空首页缓存
function clearIndexCache(){
	for (var i = 0; i < localStorage.length; i++) {
	    var key = localStorage.key(i); 
		if(key.indexOf("indexdata") != -1){
			remove_cache(key);
		}
	}
}

function clearAllRecord(){
	for (var i = 0; i < localStorage.length; i++) {
	    var key = localStorage.key(i); 
		if(key.indexOf("indexdata") == -1){
			remove_cache(key);
		}
	}
	vant.Toast("缓存已清空！");
}

//写入cookie
function setCookie(name,value){
	var Days = 360;
	var exp = new Date();
	exp.setTime(exp.getTime() + Days*24*60*60*1000);
	document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
}

//获取cookie
function getCookie(name){
	var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
	if(arr=document.cookie.match(reg)){
		return unescape(arr[2]);
	}else{
		return null;
	}
}
	
//删除cookie
function delCookie(name){
	var exp = new Date();
	exp.setTime(exp.getTime() - 1);
	var cval=getCookie(name);
	if(cval!=null)
	document.cookie= name + "="+cval+";expires="+exp.toGMTString();
}

/**
 * @param {Object} time
 * 说明:格式化时间戳getLocalTime(1470800400); 
 * 输出：2016-08-10 11:40:00
 */
function getLocalTime(time){
	var datetime = new Date();
	datetime.setTime(parseInt(time+'000'));
	var year = datetime.getFullYear();
	var month = datetime.getMonth() + 1 < 10 ? "0" + (datetime.getMonth() + 1) : datetime.getMonth() + 1;
	var date = datetime.getDate() < 10 ? "0" + datetime.getDate() : datetime.getDate();
	var hour = datetime.getHours()< 10 ? "0" + datetime.getHours() : datetime.getHours();
	var minute = datetime.getMinutes()< 10 ? "0" + datetime.getMinutes() : datetime.getMinutes();
	var second = datetime.getSeconds()< 10 ? "0" + datetime.getSeconds() : datetime.getSeconds();
	return year + "-" + month + "-" + date+" "+hour+":"+minute+":"+second;
}

function formatDateTime(date) {
	var y = date.getFullYear();
	var m = date.getMonth() + 1;
	m = m < 10 ? ('0' + m) : m;
	var d = date.getDate();
	d = d < 10 ? ('0' + d) : d;
	var h = date.getHours();
	h=h < 10 ? ('0' + h) : h;
	var minute = date.getMinutes();
	minute = minute < 10 ? ('0' + minute) : minute;
	var second=date.getSeconds();
	second=second < 10 ? ('0' + second) : second;
	return y + '-' + m + '-' + d+' '+h+':'+minute+':'+second;
}

function clearAllCookie() {
	var date=new Date();
	date.setTime(date.getTime()-10000);
	var keys=document.cookie.match(/[^ =;]+(?=\=)/g);
	if (keys) {
		for (var i =  keys.length; i--;)
		document.cookie=keys[i]+"=0; expire="+date.toGMTString()+"; path=/";
	}
}

function getAllCookie(){
	var cookie_list=[];
	var strCookie = document.cookie;
	var arrCookie = strCookie.split("; ");
	for(var i = 0; i < arrCookie.length; i++){
	   var arr = arrCookie[i].split("=");
	   var obj = {
		   "time": arr[0],
		   "vname": unescape(arr[1]).length > 7 ? unescape(arr[1]).substring(0,6) + '...' : unescape(arr[1])
	   };
	   cookie_list.push(obj);
	}
	var res = insertSort(cookie_list).slice(0,23);
	res.push({"time":"1977-01-01 00:00:00","vname":"更多>>"});
	return res;
}

/**
 * 冒泡排序
 * @param {Object} arr
 */
function insertSort(arr) {
    var len = arr.length;
    for (var i = 0; i < len-1; i++) {
       for (var j = 0; j < len - 1 - i; j++) {
           if (arr[j].time < arr[j + 1].time) {
               var temp = arr[j].vname;
               arr[j].vname = arr[j+1].vname;
               arr[j+1].vname = temp;
           }
       }
    }
    return arr;
}

//l:localStorage当前大小 s:sessionStorage当前大小
function get_cache_size(t){
    t = t == undefined ? "l" : t;
    var obj = "";
    if(t==='l'){
        if(window.localStorage) {
            obj = window.localStorage;
        }
    }else{
        if(window.sessionStorage) {
            obj = window.sessionStorage;
        }
    }
    if(obj!==""){
        var size = 0;
        for(item in obj) {
            if(obj.hasOwnProperty(item)) {
                size += obj.getItem(item).length;
            }
        }
		return (size / 1024 / 1024).toFixed(2)-0.12;
    }
}